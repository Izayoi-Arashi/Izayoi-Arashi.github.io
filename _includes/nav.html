<html lang="en">
{% include head.html %}

<body ontouchstart="">
    <!-- 加载过渡页面 -->
    <div id="loadingScreen">
        <div class="spinner"></div>
        <p>正在加载...</p>
    </div>

    <!-- 更新后的导航栏 -->
    <nav class="navbar navbar-default navbar-custom navbar-fixed-top">
        <div class="container-fluid">
            <div class="navbar-header page-scroll">
                <button type="button" class="navbar-toggle" aria-label="Toggle navigation">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand" href="{{ site.baseurl }}/">{{ site.title }}</a>
            </div>

            <div id="huxblog_navbar">
                <div class="navbar-collapse">
                    <ul class="nav navbar-nav navbar-right">
                        <li><a href="{{ site.baseurl }}/">Home</a></li>
                        {% for page in site.pages %}
                            {% if page.title and page.hide-in-nav != true %}
                                <li><a href="{{ page.url | prepend: site.baseurl }}">{{ page.title }}</a></li>
                            {% endif %}
                        {% endfor %}
                        <li class="search-icon">
                            <a href="javascript:void(0)">
                                <i class="fa fa-search"></i>
                            </a>
                        </li>
                        <!-- 集成菜单按钮 -->
                        <li>
                            <button id="menu-toggle" class="control-button" aria-label="主菜单">
                                <i class="fas fa-bars"></i>
                            </button>
                        </li>
                    </ul>
                </div>
            </div>
        </div>
    </nav>

    <!-- 控制菜单 -->
    <div id="control-menu">
        <button id="menu-toggle" class="control-button" aria-label="主菜单">
            <i class="fas fa-bars"></i>
        </button>
        <div id="menu-content">
            <div id="email-copy" title="邮箱" class="control-button">
                <i class="far fa-envelope"></i>
            </div>
            <div id="announcement-toggle" title="公告通知" class="control-button">
                <i class="fas fa-bullhorn"></i>
            </div>
            <div id="dark-mode-toggle" title="深色模式" class="control-button">
                <i class="fas fa-moon"></i>
            </div>
            <div id="music-control" title="音乐播放" class="control-button">
                <button id="play-pause-btn">
                    <i class="fas fa-play"></i>
                </button>
                <audio id="music-player">
                    <source src="{{ '/music/song.mp3' | relative_url }}" type="audio/mp3">
                    Your browser does not support the audio element.
                </audio>
            </div>
            <div id="petals-toggle" title="花瓣效果" class="control-button">
                <i class="fas fa-leaf"></i>
            </div>
        </div>
    </div>

    <!-- 公告弹窗 -->
    <div id="announcement-modal" class="modal">
        <div class="modal-content">
            <span class="close-modal">&times;</span>
            <div id="loading-indicator" class="loading-indicator">
                <div class="spinner"></div>
                <p>正在加载公告...</p>
            </div>
            <div id="announcement-content" style="display: none;"></div>
        </div>
    </div>

    {{ content }}
    {% include footer.html %}

    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script>
        // 公告功能
        const announcementToggle = document.getElementById("announcement-toggle");
        const announcementModal = document.getElementById("announcement-modal");
        const closeModal = document.querySelector(".close-modal");
        const announcementContent = document.getElementById("announcement-content");
        const loadingIndicator = document.getElementById("loading-indicator");

        announcementToggle.addEventListener("click", loadAnnouncement);

        function loadAnnouncement() {
            loadingIndicator.style.display = "block";
            announcementContent.style.display = "none";
            const announcementUrl = "{{ site.url }}{{ site.baseurl }}{{ site.announcement_path }}?t=" + Date.now();
            fetch(announcementUrl)
                .then(response => response.text())
                .then(text => {
                    const content = text.replace(/^---[\s\S]*?---/, '').trim();
                    if (content) {
                        announcementContent.innerHTML = marked.parse(content);
                    } else {
                        announcementContent.innerHTML = '<p class="no-content">暂无公告</p>';
                    }
                    loadingIndicator.style.display = "none";
                    announcementContent.style.display = "block";
                    announcementModal.style.display = "block";
                    document.body.style.overflow = "hidden";
                })
                .catch(error => {
                    announcementContent.innerHTML = `<p class="error">加载失败：${error.message}</p>`;
                    loadingIndicator.style.display = "none";
                    announcementContent.style.display = "block";
                    announcementModal.style.display = "block";
                    document.body.style.overflow = "hidden";
                });
        }

        closeModal.addEventListener("click", function() {
            announcementModal.style.display = "none";
            document.body.style.overflow = "auto";
        });

        window.addEventListener("click", function(event) {
            if (event.target === announcementModal) {
                announcementModal.style.display = "none";
                document.body.style.overflow = "auto";
            }
        });

        // 控制菜单逻辑
        const menuToggle = document.getElementById("menu-toggle");
        const menuContent = document.getElementById("menu-content");

        menuToggle.addEventListener("click", function() {
            menuContent.classList.toggle("active");
        });
    </script>
    <script src="{{ '/js/control-menu.js' | relative_url }}"></script>
    <link rel="stylesheet" href="{{ '/css/control-menu.min.css' | relative_url }}">
</body>
</html>
